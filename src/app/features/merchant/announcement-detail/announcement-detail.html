<!-- CORRIGÉ: Utilise 'announcement' (l'objet) au lieu de 'announcement$ | async' -->
<div class="content p-6" *ngIf="announcement; else loading">

    <!-- Entête -->
    <div class="header">
        <div class="header-info">
            <h2 class="truncate">{{ announcement.title }}</h2>
            <!-- CORRIGÉ: Utilise StatusBadge -->
            <app-status-badge [status]="announcement.moderationStatus"></app-status-badge>
        </div>
        <div class="header-actions">
            <!-- CORRIGÉ: Appelle 'requestDelete()' -->
            <button (click)="requestDelete()" class="action-btn btn-reject">
                <i class="fa-solid fa-trash"></i> Supprimer
            </button>
            <!-- CORRIGÉ: Appelle 'onEdit()' -->
            <button (click)="onEdit(announcement.id)" class="action-btn btn-edit">
                <i class="fa-solid fa-pen"></i> Modifier
            </button>
        </div>
    </div>

    <!-- Corps -->
    <div class="body-grid">
        <!-- Section Image -->
        <div class="image-container">
            <!-- CORRIGÉ: Utilise le helper 'getImageUrl' -->
            <img [src]="getImageUrl(announcement.imageUrl)" alt="Photo de l'annonce"
                onerror="this.src='assets/images/replate-bg.png'">
        </div>

        <!-- Section Infos -->
        <div class="info-container">
            <h3 class="section-title">Description</h3>
            <p class="description">{{ announcement.description }}</p>

            <div class="info-grid">
                <div>
                    <span>Statut</span>
                    <strong>{{ (announcement.moderationStatus | titlecase).replace('_', ' ') }}</strong>
                </div>
                <div>
                    <span>Type</span>
                    <strong>{{ announcement.type | titlecase }}</strong>
                </div>
                <div>
                    <span>Quantité</span>
                    <strong>{{ announcement.quantity }}</strong>
                </div>
                <div>
                    <span>Nourriture</span>
                    <strong>{{ announcement.foodType }}</strong>
                </div>
                <div>
                    <span>Date d'expiration</span>
                    <strong>{{ announcement.expiryDate | date:'dd/MM/yyyy' }}</strong>
                </div>
                <div>
                    <span>Récupération</span>
                    <strong>{{ announcement.pickupTime | date:'dd/MM/yyyy à HH:mm' }}</strong>
                </div>
            </div>

            <h3 class="section-title mt-4">Adresse de récupération</h3>
            <div class="address-box">
                <i class="fa-solid fa-map-marker-alt"></i>
                <strong>{{ announcement.address }}</strong>
            </div>
        </div>

        <!-- Section Offres (Pas encore implémentée) -->
        <div class="offers-container">
            <h3>Offres Reçues ({{ 0 }})</h3>
            <div class="offer-placeholder">
                <i class="fa-solid fa-inbox"></i>
                <p>Aucune offre reçue pour le moment.</p>
            </div>
        </div>
    </div>

</div>

<!-- Template de chargement -->
<ng-template #loading>
    <div class="loading-placeholder">
        <i class="fa-solid fa-spinner fa-spin"></i>
        <p>Chargement de l'annonce...</p>
    </div>
</ng-template>

<!-- CORRIGÉ: Ajout du dialogue de confirmation -->
<app-confirm-dialog *ngIf="showDeleteConfirm" title="Confirmer la suppression"
    message="Êtes-vous sûr de vouloir supprimer cette annonce ? Cette action est irréversible."
    (onClose)="handleDeleteConfirm($event)">
</app-confirm-dialog>