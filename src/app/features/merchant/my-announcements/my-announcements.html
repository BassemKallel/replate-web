<!-- Fichier HTML pour MyAnnouncements -->
<div class="container">
    <div class="header">
        <h1>Mes Annonces</h1>
        <p>Gérez vos dons et demandes actifs.</p>
    </div>

    <div class="actions-bar">
        <div class="filters">
            <!-- Les filtres peuvent être ajoutés ici -->
        </div>
        <!-- CORRIGÉ: Appelle navigateToCreate() -->
        <button (click)="navigateToCreate()" class="btn-create">
            <i class="fa-solid fa-plus"></i>
            Nouvelle annonce
        </button>
    </div>

    <!-- CORRIGÉ: Utilise 'announcements' (le tableau) au lieu de 'announcements$ | async' -->
    <div class="list-container">

        <!-- État vide -->
        <div *ngIf="announcements.length === 0" class="empty-state">
            <i class="fa-solid fa-box-open"></i>
            <h3>Aucune annonce trouvée</h3>
            <p>Commencez par créer une nouvelle annonce.</p>
        </div>

        <!-- Grille des annonces -->
        <div class="announcement-grid" *ngIf="announcements.length > 0">

            <!-- CORRIGÉ: Boucle sur 'announcements' -->
            <div *ngFor="let ann of announcements" class="announcement-card" (click)="navigateToDetail(ann.id)">

                <div class="card-image">
                    <!-- CORRIGÉ: Utilise le helper 'getImageUrl' et non 'baseUrl' -->
                    <img [src]="getImageUrl(ann.imageUrl)" alt="Photo de l'annonce"
                        onerror="this.src='assets/images/replate-bg.png'">
                    <!-- CORRIGÉ: Utilise StatusBadge -->
                    <app-status-badge [status]="ann.moderationStatus"></app-status-badge>
                </div>

                <div class="card-content">
                    <h3 class="card-title">{{ ann.title }}</h3>
                    <p class="card-type">{{ ann.type }}</p>
                    <p class="card-date">
                        Expire le: {{ ann.expiryDate | date:'dd/MM/yyyy' }}
                    </p>
                </div>

                <div class="card-footer">
                    <!-- CORRIGÉ: Utilise RouterLink -->
                    <a [routerLink]="['/merchant/edit', ann.id]" (click)="$event.stopPropagation()" class="btn-edit">
                        <i class="fa-solid fa-pen"></i> Modifier
                    </a>
                    <!-- CORRIGÉ: Utilise ConfirmDialog -->
                    <button (click)="requestDelete(ann.id); $event.stopPropagation()" class="btn-delete">
                        <i class="fa-solid fa-trash"></i> Supprimer
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- CORRIGÉ: Utilise ConfirmDialog -->
<app-confirm-dialog *ngIf="showDeleteConfirm" title="Confirmer la suppression"
    message="Êtes-vous sûr de vouloir supprimer cette annonce ? Cette action est irréversible."
    (onClose)="handleDeleteConfirm($event)">
</app-confirm-dialog>